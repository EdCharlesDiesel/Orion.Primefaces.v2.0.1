<div class="dashboard-container" *ngIf="!loading(); else loadingTemplate">
  <!-- Stats Cards -->
  <div class="stats-grid">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div>
            <div class="stat-label">Total Products</div>
            <div class="stat-value">{{ stats().totalProducts }}</div>
          </div>
          <mat-icon class="stat-icon blue">inventory_2</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div>
            <div class="stat-label">Average Price</div>
            <div class="stat-value">${{ stats().avgPrice }}</div>
          </div>
          <mat-icon class="stat-icon green">trending_up</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div>
            <div class="stat-label">Categories</div>
            <div class="stat-value">{{ stats().categories }}</div>
          </div>
          <mat-icon class="stat-icon purple">category</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div>
            <div class="stat-label">Highest Rating</div>
            <div class="stat-value">{{ stats().highestRated }}</div>
          </div>
          <mat-icon class="stat-icon yellow">star</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Category Filter -->
  <mat-card class="filter-card">
    <mat-card-header>
      <mat-card-title>Filter by Category</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-chip-listbox class="chip-list" (change)="onCategoryChange($event)">
        <mat-chip-option
          [selected]="selectedCategory() === 'all'"
          (click)="selectedCategory.set('all')">
          All Products
        </mat-chip-option>
        <mat-chip-option
          *ngFor="let category of categories()"
          [selected]="selectedCategory() === category"
          (click)="selectedCategory.set(category)">
          {{ category }}
        </mat-chip-option>
      </mat-chip-listbox>
    </mat-card-content>
  </mat-card>

  <!-- Products Section -->
  <mat-card class="products-card">
    <mat-card-header>
      <mat-card-title>Products ({{ filteredProducts().length }})</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="products-grid">
        <mat-card *ngFor="let product of filteredProducts()" class="product-card">
          <div class="product-image-container">
            <img
              mat-card-image
              [src]="product.image"
              [alt]="product.title"
              class="product-image">
          </div>
          <mat-card-content>
            <div class="category-badge">{{ product.category }}</div>
            <h3 class="product-title">{{ product.title }}</h3>
            <div class="product-footer">
              <span class="product-price">${{ product.price }}</span>
              <div class="product-rating">
                <mat-icon class="rating-icon">star</mat-icon>
                <span class="rating-value">{{ product.rating.rate }}</span>
                <span class="rating-count">({{ product.rating.count }})</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<ng-template #loadingTemplate>
  <div class="loading-container">
    <mat-spinner></mat-spinner>
    <p class="loading-text">Loading dashboard...</p>
  </div>
</ng-template>
